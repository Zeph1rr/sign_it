name: build binary

on:
  push:
    branches-ingore: [release]

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    if: ${{ contains( github.event.commits[0].message, '_' ) }}
    steps:
      - name: Check-out repository
        uses: actions/checkout@v2

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: build
        run: pyinstaller -F -n sign_it --add-data src:./ ./src/main.py

      - name: commit and push
        uses: devops-infra/action-commit-push@master
        with:
          github_token: "${{ secrets.ACCESS_TOKEN }}"
          add_timestamp: false
          commit_prefix: "[AUTO]"
          commit_message: "release new version"
          force: false
          target_branch: release

